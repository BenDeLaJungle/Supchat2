openapi: 3.0.0
info:
  title: Supchat
  description: une API de chat pour une entreprise
  version: 1.0.0

servers:
  - url: http://localhost:8000
    description: Serveur local Symfony

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    ChannelOptions:
      type: object
      properties:
        id:
          type: integer
        channel:
          $ref: '#/components/schemas/Channels'
        user:
          $ref: '#/components/schemas/Users'
        pushUp:
          type: boolean
        mail:
          type: boolean
        notification:
          type: string
          enum: [all, mention, none]
      required: [channel, user, pushUp, mail, notification]

    Channels:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          minLength: 3
          maxLength: 255
        workspace:
          $ref: '#/components/schemas/Workspaces'
        status:
          type: boolean
          description: true = public, false = private
        minRole:
          type: integer
          default: 1
          description: 1 = membre, 2 = mod√©rateur, 3 = admin
      required: [name, workspace, status]

    Files:
      type: object
      properties:
        id:
          type: integer
        message:
          $ref: '#/components/schemas/Messages'
        path:
          type: string
          maxLength: 255
      required: [message, path]

    Hashtags:
      type: object
      properties:
        id:
          type: integer
        channel:
          $ref: '#/components/schemas/Channels'
        message:
          $ref: '#/components/schemas/Messages'
      required: [channel, message]

    Mentions:
      type: object
      properties:
        id:
          type: integer
        message:
          $ref: '#/components/schemas/Messages'
        user:
          $ref: '#/components/schemas/Users'
      required: [message, user]

    Messages:
      type: object
      properties:
        id:
          type: integer
        channel:
          $ref: '#/components/schemas/Channels'
          nullable: true
        user:
          $ref: '#/components/schemas/Users'
        recipient:
          $ref: '#/components/schemas/Users'
          nullable: true
        content:
          type: string
          minLength: 1
          maxLength: 5000
        createdAt:
          type: string
          format: date-time
        hashtags:
          type: array
          items:
            $ref: '#/components/schemas/Hashtags'
        notifications:
          type: array
          items:
            $ref: '#/components/schemas/Notifications'
      required: [user, content, createdAt]

    Notifications:
      type: object
      properties:
        id:
          type: integer
        message:
          $ref: '#/components/schemas/Messages'
          nullable: true
        user:
          $ref: '#/components/schemas/Users'
        atRead:
          type: boolean
      required: [user, atRead]

    Reactions:
      type: object
      properties:
        id:
          type: integer
        message:
          $ref: '#/components/schemas/Messages'
        user:
          $ref: '#/components/schemas/Users'
        emojiCode:
          type: string
          minLength: 1
          maxLength: 10
      required: [message, user, emojiCode]

    Roles:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          minLength: 3
          maxLength: 255
        publish:
          type: boolean
        moderate:
          type: boolean
        manage:
          type: boolean
      required: [name, publish, moderate, manage]

    Users:
      type: object
      properties:
        id:
          type: integer
        firstName:
          type: string
          minLength: 3
          maxLength: 255
        lastName:
          type: string
          minLength: 3
          maxLength: 255
        userName:
          type: string
          minLength: 3
          maxLength: 255
        emailAddress:
          type: string
          format: email
          minLength: 3
          maxLength: 255
        password:
          type: string
          minLength: 8
          maxLength: 255
          nullable: true
        role:
          type: string
          enum: ["ROLE_USER", "ROLE_ADMIN"]
        theme:
          type: boolean
        status:
          type: string
          minLength: 3
          maxLength: 255
      required: [firstName, lastName, userName, emailAddress, role, theme, status]

    WorkspaceMembers:
      type: object
      properties:
        id:
          type: integer
        workspace:
          $ref: '#/components/schemas/Workspaces'
        user:
          $ref: '#/components/schemas/Users'
        role:
          $ref: '#/components/schemas/Roles'
        publish:
          type: boolean
        moderate:
          type: boolean
        manage:
          type: boolean
      required: [workspace, user, role, publish, moderate, manage]

    Workspaces:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          minLength: 3
          maxLength: 255
        status:
          type: boolean
          description: true = public, false = private
        creator:
          $ref: '#/components/schemas/Users'
      required: [name, status, creator]

    RoleInput:
      type: object
      required: [name, publish, moderate, manage]
      properties:
        name:
          type: string
          example: "Mod√©rateur"
        publish:
          type: boolean
          example: true
        moderate:
          type: boolean
          example: false
        manage:
          type: boolean
          example: false

    MessagePreview:
      type: object
      properties:
        id:
          type: integer
          example: 128
        content:
          type: string
          example: "Coucou, vous avez vu la nouvelle..."
        preview:
          type: string
          example: "Coucou, vous avez vu la nouv..."
        channelId:
          type: integer
          nullable: true
          example: 5

    Error:
      type: object
      properties:
        error:
          type: string
          example: "Param√®tre de recherche manquant"


paths:
  /api/admin/workspaces:
    get:
      tags: [Admin - Workspaces]
      summary: Liste tous les workspaces
      operationId: listAllWorkspaces
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Liste des workspaces
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Workspaces'
        '401':
          description: Non autoris√© (JWT requis)

  /api/admin/workspaces/{id}:
      delete:
        tags: [Admin - Workspaces]
        summary: D√©sactive un workspace
        operationId: softDeleteWorkspace
        security:
          - BearerAuth: []
        parameters:
          - name: id
            in: path
            required: true
            schema:
              type: integer
        responses:
          '200':
            description: Workspace d√©sactiv√© avec succ√®s
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    message:
                      type: string
          '404':
            description: Workspace non trouv√©
          '401':
            description: Non autoris√©

      put:
        tags: [Admin - Workspaces]
        summary: Met √† jour un workspace
        operationId: updateWorkspace
        security:
          - BearerAuth: []
        parameters:
          - name: id
            in: path
            required: true
            schema:
              type: integer
        requestBody:
          required: true
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                  status:
                    type: boolean
                example:
                  name: "Nouveau nom"
                  status: true
        responses:
          '200':
            description: Workspace mis √† jour
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    message:
                      type: string
                    id:
                      type: integer
                    name:
                      type: string
                    status:
                      type: boolean
          '400':
            description: Requ√™te invalide
          '404':
            description: Workspace non trouv√©
          '401':
            description: Non autoris√©

  /api/auth/register:
      post:
        tags: [Auth]
        summary: Inscription d‚Äôun nouvel utilisateur
        operationId: registerUser
        requestBody:
          required: true
          content:
            application/json:
              schema:
                type: object
                required: [firstName, lastName, userName, emailAddress, password]
                properties:
                  firstName:
                    type: string
                  lastName:
                    type: string
                  userName:
                    type: string
                  emailAddress:
                    type: string
                    format: email
                  password:
                    type: string
        responses:
          '201':
            description: Utilisateur inscrit avec succ√®s
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    message:
                      type: string
                    userId:
                      type: integer
          '400':
            description: Donn√©es incompl√®tes
          '409':
            description: Email d√©j√† utilis√©

  /api/auth/login:
      post:
        tags: [Auth]
        summary: Connexion d‚Äôun utilisateur
        operationId: loginUser
        requestBody:
          required: true
          content:
            application/json:
              schema:
                type: object
                required: [emailAddress, password]
                properties:
                  emailAddress:
                    type: string
                    format: email
                  password:
                    type: string
        responses:
          '200':
            description: Connexion r√©ussie
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    token:
                      type: string
                    user:
                      $ref: '#/components/schemas/Users'
          '400':
            description: Donn√©es incompl√®tes
          '401':
            description: Identifiants invalides

  /api/auth/logout:
      post:
        tags: [Auth]
        summary: D√©connexion de l‚Äôutilisateur
        operationId: logoutUser
        responses:
          '200':
            description: D√©connexion r√©ussie
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    message:
                      type: string

  /api/auth/refresh:
      get:
        tags: [Auth]
        summary: Rafra√Æchissement du token JWT
        operationId: refreshToken
        security:
          - BearerAuth: []
        responses:
          '200':
            description: Nouveau token g√©n√©r√©
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    token:
                      type: string
          '401':
            description: Token invalide ou manquant

  /api/channels/{id}:
    get:
      tags: [Channels]
      summary: R√©cup√®re un channel
      operationId: getChannel
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: D√©tails du channel
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Channels'
        '403':
          description: Acc√®s interdit
        '404':
          description: Channel introuvable

    put:
      tags: [Channels]
      summary: Met √† jour un channel
      operationId: updateChannel
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                status:
                  type: boolean
                min_role:
                  type: integer
      responses:
        '200':
          description: Canal mis √† jour
        '400':
          description: Requ√™te invalide

    delete:
      tags: [Channels]
      summary: Supprime un channel
      operationId: deleteChannel
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Canal supprim√©

  /api/channels:
    post:
      tags: [Channels]
      summary: Cr√©e un nouveau canal
      operationId: createChannel
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [workspace_id, status]
              properties:
                workspace_id:
                  type: integer
                status:
                  type: boolean
                name:
                  type: string
                participants:
                  type: array
                  items:
                    type: integer
                min_role:
                  type: integer
      responses:
        '201':
          description: Canal cr√©√©
        '400':
          description: Donn√©es invalides ou incompl√®tes
        '403':
          description: Acc√®s refus√©
        '409':
          description: Canal d√©j√† existant

  /api/channels/simple:
    post:
      tags: [Channels]
      summary: Cr√©e une conversation priv√©e simple
      operationId: createSimplePrivateChannel
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required: [workspace_id, status, participants]
              properties:
                workspace_id:
                  type: integer
                status:
                  type: boolean
                participants:
                  type: array
                  items:
                    type: integer
      responses:
        '201':
          description: Canal priv√© cr√©√©
        '400':
          description: Donn√©es invalides ou manquantes
        '409':
          description: Canal d√©j√† existant

  /api/channels/{id}/privilege:
    post:
      tags: [Channels]
      summary: R√©cup√®re les privil√®ges d‚Äôun utilisateur dans un canal
      operationId: getChannelPrivilege
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required: [user_id]
              properties:
                user_id:
                  type: integer
      responses:
        '200':
          description: Privil√®ges renvoy√©s
          content:
            application/json:
              schema:
                type: object
                properties:
                  is_admin:
                    type: boolean
                  can_moderate:
                    type: boolean
                  can_manage:
                    type: boolean
        '400':
          description: ID utilisateur manquant
        '404':
          description: Utilisateur introuvable

  /api/channels/by-name/{name}:
    get:
      tags: [Channels]
      summary: R√©cup√®re un canal par son nom
      operationId: getChannelByName
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: name
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Canal trouv√©
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Channels'
        '404':
          description: Canal non trouv√©

  /api/workspaces/{id}/channels:
    get:
      tags: [Channels]
      summary: Liste les channels d‚Äôun workspace
      operationId: getChannelsByWorkspace
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Liste des channels
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Channels'

  /api/files/upload:
    post:
      tags: [Files]
      summary: Upload d‚Äôun fichier li√© √† un message
      operationId: uploadFile
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file, message_id]
              properties:
                file:
                  type: string
                  format: binary
                message_id:
                  type: integer
      responses:
        '201':
          description: Fichier upload√© avec succ√®s
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  filePath:
                    type: string
        '400':
          description: Fichier ou message_id manquant ou type invalide
        '404':
          description: Message introuvable
        '500':
          description: √âchec de l‚Äôupload

  /api/files/me:
    get:
      tags: [Files]
      summary: Liste des fichiers que j‚Äôai envoy√©s
      operationId: getMyFiles
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Liste des fichiers
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    path:
                      type: string
                    name:
                      type: string

  /api/files/shared:
    get:
      tags: [Files]
      summary: Fichiers envoy√©s par d'autres dans mes workspaces
      operationId: getSharedFiles
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Liste des fichiers partag√©s
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    path:
                      type: string
                    name:
                      type: string
                    author:
                      type: string

  /api/files/{id}/generate-download-url:
    get:
      tags: [Files]
      summary: G√©n√®re une URL temporaire de t√©l√©chargement s√©curis√©
      operationId: generateDownloadUrl
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: URL g√©n√©r√©e avec succ√®s
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
        '403':
          description: Signature invalide ou lien expir√©
        '404':
          description: Fichier introuvable

  /api/files/download:
    get:
      tags: [Files]
      summary: T√©l√©chargement s√©curis√© via URL sign√©e
      operationId: downloadFile
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: integer
        - name: user
          in: query
          required: true
          schema:
            type: integer
        - name: ts
          in: query
          required: true
          schema:
            type: integer
        - name: _hash
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Fichier t√©l√©charg√©
        '400':
          description: Param√®tres manquants
        '403':
          description: Signature invalide ou expir√©e
        '404':
          description: Fichier non trouv√©

  /api/files/{id}:
    delete:
      tags: [Files]
      summary: Supprime un fichier
      operationId: deleteFile
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Fichier supprim√©
        '403':
          description: Acc√®s interdit
        '404':
          description: Fichier introuvable

  /api/hashtags:
    post:
      tags: [Hashtags]
      summary: Cr√©e des hashtags pour lier un channel a un message
      operationId: createHashtags
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [message_id, channels]
              properties:
                message_id:
                  type: integer
                channels:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Hashtags cr√©√©s avec succ√®s
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  channels:
                    type: array
                    items:
                      type: string
        '400':
          description: Donn√©es manquantes
        '404':
          description: Message introuvable

  /api/mention/add:
    post:
      tags: [Mentions]
      summary: Ajoute une mention √† un message
      operationId: addMention
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [userId, messageId]
              properties:
                userId:
                  type: integer
                messageId:
                  type: integer
      responses:
        '200':
          description: Mention ajout√©e avec succ√®s
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '400':
          description: Donn√©es invalides
        '404':
          description: Utilisateur ou message introuvable

  /api/mention/{id}:
    get:
      tags: [Mentions]
      summary: R√©cup√®re une mention sp√©cifique
      operationId: getMention
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Mention trouv√©e
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                      username:
                        type: string
                  message:
                    type: object
                    properties:
                      id:
                        type: integer
        '404':
          description: Mention introuvable

  /api/messages:
    post:
      tags: [Messages]
      summary: Cr√©e un nouveau message
      operationId: createMessage
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required: [channel_id, user_id, content]
              properties:
                channel_id:
                  type: integer
                user_id:
                  type: integer
                content:
                  type: string
      responses:
        '201':
          description: Message cr√©√©
          content:
            application/json:
              schema:
                type: object
                properties:
                  id: { type: integer }
                  content: { type: string }
                  timestamp: { type: string, format: date-time }
                  author:
                    type: object
                    properties:
                      id: { type: integer }
                      username: { type: string }
                  channel_id: { type: integer }
        '400':
          description: Donn√©es incompl√®tes
        '404':
          description: Channel ou utilisateur non trouv√©

  /api/messages/{id}:
    get:
      tags: [Messages]
      summary: R√©cup√®re un message
      operationId: getMessage
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Message trouv√©
        '404':
          description: Message introuvable

    put:
      tags: [Messages]
      summary: Met √† jour le contenu d‚Äôun message
      operationId: updateMessage
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required: [content]
              properties:
                content:
                  type: string
      responses:
        '200':
          description: Message modifi√©
        '400':
          description: Contenu invalide

    delete:
      tags: [Messages]
      summary: Supprime un message
      operationId: deleteMessage
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Message supprim√©

  /api/channels/{id}/messages:
    get:
      tags: [Messages]
      summary: R√©cup√®re les messages d‚Äôun canal
      operationId: getChannelMessages
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Liste des messages
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id: { type: integer }
                    content: { type: string }
                    timestamp: { type: string, format: date-time }
                    author:
                      type: object
                      properties:
                        id: { type: integer }
                        username: { type: string }
                    channel_id: { type: integer }
                    hashtags:
                      type: array
                      items:
                        type: object
                        properties:
                          tag: { type: string }
                          channel:
                            type: object
                            properties:
                              id: { type: integer }
                              name: { type: string }
                    files:
                      type: array
                      items:
                        type: object
                        properties:
                          id: { type: integer }
                          name: { type: string }
                          download_url: { type: string }
        '404':
          description: Canal non trouv√©

  /api/notifications/unread:
    get:
      tags: [Notifications]
      summary: Liste les notifications non lues de l'utilisateur connect√©
      operationId: getUnreadNotifications
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Liste des notifications
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id: { type: integer }
                    message: { type: string }
                    read: { type: boolean }

  /api/notifications/create:
    post:
      tags: [Notifications]
      summary: Cr√©e une notification pour un utilisateur
      operationId: createNotification
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required: [userId, messageId]
              properties:
                userId:
                  type: integer
                messageId:
                  type: integer
      responses:
        '200':
          description: Notification cr√©√©e
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean }
                  id: { type: integer }
        '400':
          description: Donn√©es invalides ou entit√© introuvable

  /api/auth/google:
    get:
      tags:
        - Authentification OAuth
      summary: Redirige vers Google pour l'authentification
      responses:
        '302':
          description: Redirection vers Google

  /api/auth/google/check:
    get:
      tags:
        - Authentification OAuth
      summary: Callback Google OAuth
      responses:
        '200':
          description: Authentification Google r√©ussie
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Authentification Google r√©ussie

  /api/auth/facebook:
    get:
      tags:
        - Authentification OAuth
      summary: Redirige vers Facebook pour l'authentification
      responses:
        '302':
          description: Redirection vers Facebook

  /api/auth/facebook/check:
    get:
      tags:
        - Authentification OAuth
      summary: Callback Facebook OAuth
      responses:
        '200':
          description: Authentification Facebook r√©ussie
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Authentification Facebook r√©ussie

  /api/reaction/add:
    post:
      tags:
        - R√©actions
      summary: Ajouter une r√©action √† un message
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [emoji, messageId, userId]
              properties:
                emoji:
                  type: string
                  example: "üî•"
                messageId:
                  type: integer
                  example: 42
                userId:
                  type: integer
                  example: 7
      responses:
        '201':
          description: R√©action ajout√©e
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: R√©action ajout√©e
                  reaction:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      emoji:
                        type: string
                        example: "üî•"
                      user:
                        type: object
                        properties:
                          id:
                            type: integer
                            example: 7
                          username:
                            type: string
                            example: "coolUser"
                      message:
                        type: object
                        properties:
                          id:
                            type: integer
                            example: 42
        '400':
          description: Donn√©es invalides
        '404':
          description: Utilisateur ou message introuvable

  /api/reaction/remove/{id}:
    delete:
      tags:
        - R√©actions
      summary: Supprimer une r√©action
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID de la r√©action
      security:
        - BearerAuth: []
      responses:
        '200':
          description: R√©action supprim√©e
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: R√©action supprim√©e
        '403':
          description: Pas autoris√©
        '404':
          description: R√©action non trouv√©e

  /api/roles:
    get:
      tags: [R√¥les]
      summary: Lister tous les r√¥les
      responses:
        '200':
          description: Liste des r√¥les
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Roles'

    post:
      tags: [R√¥les]
      summary: Cr√©er un nouveau r√¥le
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleInput'
      responses:
        '201':
          description: R√¥le cr√©√© avec succ√®s
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: R√¥le cr√©√© avec succ√®s
                  role:
                    $ref: '#/components/schemas/Roles'
        '415':
          description: Content-Type invalide
        '400':
          description: Donn√©es invalides

  /api/roles/{id}:
    get:
      tags: [R√¥les]
      summary: D√©tails d‚Äôun r√¥le
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: D√©tails du r√¥le
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Roles'
        '404':
          description: R√¥le non trouv√©

    put:
      tags: [R√¥les]
      summary: Mettre √† jour un r√¥le
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleInput'
      responses:
        '200':
          description: R√¥le mis √† jour avec succ√®s
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: R√¥le mis √† jour avec succ√®s
                  role:
                    $ref: '#/components/schemas/Roles'
        '404':
          description: R√¥le non trouv√©
        '400':
          description: Donn√©es invalides

    delete:
      tags: [R√¥les]
      summary: Supprimer un r√¥le
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: R√¥le supprim√© avec succ√®s
        '404':
          description: R√¥le non trouv√©
        '400':
          description: R√¥le encore attribu√© √† des utilisateurs

  /api/search:
    get:
      tags:
        - Search
      summary: Recherche globale
      description: Recherche parmi les utilisateurs, channels, fichiers et messages accessibles √† l'utilisateur connect√©.
      operationId: globalSearch
      parameters:
        - name: query
          in: query
          required: true
          description: Terme de recherche √† effectuer.
          schema:
            type: string
      responses:
        '200':
          description: R√©sultats de la recherche
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      $ref: '#/components/schemas/Users'
                  channels:
                    type: array
                    items:
                      $ref: '#/components/schemas/Channels'
                  files:
                    type: array
                    items:
                      $ref: '#/components/schemas/Files'
                  messages:
                    type: array
                    items:
                      $ref: '#/components/schemas/MessagePreview'
        '400':
          description: Requ√™te invalide (param√®tre manquant)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/users/search:
    get:
      tags: [Users]
      summary: Recherche d'utilisateurs
      description: Recherche des utilisateurs selon un terme fourni.
      operationId: searchUsers
      security:
        - BearerAuth: []
      parameters:
        - name: query
          in: query
          required: true
          schema:
            type: string
          description: Terme de recherche
      responses:
        '200':
          description: Liste des utilisateurs correspondants
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Users'
        '400':
          description: Param√®tre manquant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/users/by-username/{username}:
    get:
      tags: [Users]
      summary: Obtenir un utilisateur par son nom d'utilisateur
      operationId: getUserByUsername
      security:
        - BearerAuth: []
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Utilisateur trouv√©
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Users'
        '404':
          description: Utilisateur introuvable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/user:
    get:
      tags: [Users]
      summary: Infos de l'utilisateur connect√©
      operationId: getUserInfo
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Infos de l'utilisateur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Users'
        '401':
          description: Non connect√©
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      tags: [Users]
      summary: Modifier les infos de l'utilisateur connect√©
      operationId: updateUser
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Users'
      responses:
        '200':
          description: Mise √† jour r√©ussie
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '401':
          description: Non connect√©
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      tags: [Users]
      summary: Supprimer son propre compte
      operationId: deleteUser
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Compte supprim√©
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '401':
          description: Non connect√©
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/workspaces/{workspaceId}/members:
    get:
      tags: [WorkspaceMembers]
      summary: Liste des membres d'un workspace
      operationId: listMembers
      security:
        - BearerAuth: []
      parameters:
        - name: workspaceId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Liste des membres
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WorkspaceMembers'
        '404':
          description: Workspace non trouv√©
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags: [WorkspaceMembers]
      summary: Ajouter un membre √† un workspace
      operationId: createMember
      security:
        - BearerAuth: []
      parameters:
        - name: workspaceId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [user_id, role_id]
              properties:
                user_id:
                  type: integer
                role_id:
                  type: integer
      responses:
        '201':
          description: Membre ajout√© avec succ√®s
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkspaceMembers'
        '400':
          description: Donn√©es invalides ou manquantes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Utilisateur non authentifi√©
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Acc√®s refus√©
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Workspace, utilisateur ou r√¥le introuvable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Utilisateur d√©j√† membre
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/workspaces/{workspaceId}/members/{memberId}:
    delete:
      tags: [WorkspaceMembers]
      summary: Supprimer un membre d'un workspace
      operationId: deleteMember
      security:
        - BearerAuth: []
      parameters:
        - name: workspaceId
          in: path
          required: true
          schema:
            type: integer
        - name: memberId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Membre supprim√© avec succ√®s
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '401':
          description: Utilisateur non authentifi√©
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Acc√®s refus√© ou cr√©ateur non supprimable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Membre ou workspace non trouv√©
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/workspaces:
    get:
      tags:
        - Workspaces
      summary: Lister les workspaces de l'utilisateur connect√©
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Liste des workspaces
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Workspaces'

    post:
      tags:
        - Workspaces
      summary: Cr√©er un nouveau workspace
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                status:
                  type: boolean
              required:
                - name
                - status
      responses:
        '201':
          description: Workspace cr√©√©
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workspaces'
        '409':
          description: Workspace d√©j√† existant

  /api/workspaces/{id}:
    get:
      tags:
        - Workspaces
      summary: Afficher un workspace
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: D√©tails du workspace
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workspaces'

    delete:
      tags:
        - Workspaces
      summary: Supprimer un workspace
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Workspace supprim√©
        '403':
          description: Acc√®s refus√©
        '400':
          description: Workspace non vide

  /api/workspaces/publics:
    get:
      tags:
        - Workspaces
      summary: Lister les workspaces publics non rejoints
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Liste des workspaces publics
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Workspaces'

  /api/workspaces/{id}/join:
    post:
      tags:
        - Workspaces
      summary: Rejoindre un workspace public
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: D√©j√† membre
        '201':
          description: Ajout√© avec succ√®s
        '404':
          description: Workspace introuvable ou non public
        '500':
          description: R√¥le introuvable
          